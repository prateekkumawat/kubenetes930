# generate key for kubernetes normal user 
openssl genrsa -out student.key 2048

# generate csr for kubernetes normal user 
openssl req -new -key student.key -out student.csr -subj "/CN=student/O=development"

# validate and generate crt for normal user 
openssl x509 -req -in student.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out student.crt -days 365

# set kubernetes credentials on your user 
kubectl config set-credentials student --client-certificate=/home/student/certs/student.crt --client-key=/home/student/certs/student.key

# set user context in kubernetes files 
kubectl config set-context student-context --cluster=kubernetes --namespace=default --user=student

# validate user in kubernetes 
kubectl config view
kubectl config get-contexts

# create a clusterRole or role for kuberenetes user 

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: student-user-role
rules:
- apiGroups: ["", "extensions", "apps"]
  resources: ["pods", "deployments", "replicasets", "pods", "daemoset", "services" ]
  verbs: ["get", "watch", "list", "create", "delete", "describe"]



# role bind for created user 
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: student-bind-role
subjects:
- kind: User
  name: student
  apiGroup: ""
roleRef:
  kind: ClusterRole 
  name: student-user-role 
  apiGroup: ""


# check user is working properly or not 
kubectl --context=kube1user-context get pod 